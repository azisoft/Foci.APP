<div class="container my-3">
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">{{ id ? 'Edit Todo' : 'Add Todo' }}</h5>
    </div>

    <div class="card-body">
      @if (loading) {
      <div class="text-center py-4">
        <div class="spinner-border text-secondary" role="status"></div>
      </div>
      } @else {
      <div>
        @if (error) {
        <div class="alert alert-danger">{{ error }}</div>
        }

        <form (ngSubmit)="save()" #form="ngForm" novalidate>
          <div class="row g-2 mb-3">
            <div class="col-md-3">
              <label class="form-label">Title</label>
              <input
                name="title"
                [(ngModel)]="model.title"
                #titleCtrl="ngModel"
                required
                minlength="1"
                class="form-control"
                [class.is-invalid]="titleCtrl.invalid && (titleCtrl.dirty || titleCtrl.touched || form.submitted)"
              />
              @if (titleCtrl.invalid && (titleCtrl.dirty || titleCtrl.touched || form.submitted)) {
              <div class="invalid-feedback">
                @if (titleCtrl.errors?.['required']) { <div>Title is required.</div> }
                @if (titleCtrl.errors?.['minlength']) { <div>Title must not be empty.</div> }
              </div>
              }
            </div>
            <div class="col-md-9">
              <label class="form-label">Description</label>
              <input
                name="description"
                [(ngModel)]="model.description"
                #descriptionCtrl="ngModel"
                required
                minlength="1"
                class="form-control"
                [class.is-invalid]="descriptionCtrl.invalid && (descriptionCtrl.dirty || descriptionCtrl.touched || form.submitted)"
              />
              @if (descriptionCtrl.invalid && (descriptionCtrl.dirty || descriptionCtrl.touched || form.submitted)) {
              <div class="invalid-feedback">
                @if (descriptionCtrl.errors?.['required']) { <div>Description is required.</div> }
                @if (descriptionCtrl.errors?.['minlength']) { <div>Description must not be empty.</div> }
              </div>
              }
            </div>
          </div>

          <div class="row g-4 mb-3">
            <div class="col-md-6">
              <label class="form-label">Due Date</label>
              <input
                class="form-control"
                type="date"
                name="dueDate"
                [(ngModel)]="model.dueDate"
              />
            </div>

            <div class="col-md-6">
              <label class="form-label" for="isCompleted">Completed</label>
              <div class="form-check form-switch mt-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  role="switch"
                  id="isCompleted"
                  name="isCompleted"
                  [(ngModel)]="model.isCompleted"
                  #completedCtrl="ngModel"
                />
                <label class="form-check-label" for="isCompleted">Completed</label>
              </div>
              @if (completedCtrl.invalid && (completedCtrl.dirty || completedCtrl.touched || form.submitted)) {
              <div class="invalid-feedback d-block">
                <div>Invalid completed value.</div>
              </div>
              }
            </div>
          </div>

          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary" [disabled]="saving || !form.form.valid">
              @if (saving) { <span class="spinner-border spinner-border-sm me-2"></span> }
              Save
            </button>
            <button type="button" class="btn btn-secondary" (click)="cancel()" [disabled]="saving">Cancel</button>
          </div>
        </form>
      </div>
      }
    </div>
  </div>
</div>